# Migration `20200521170419-puzzle-initial`

This migration has been generated by eshell at 5/21/2020, 5:04:19 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Folder" (
"folderId" integer   ,"id" SERIAL,"name" text   ,"puzzleLevel" integer  NOT NULL ,"puzzleSize" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Group" (
"id" SERIAL,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Hint" (
"hint" text  NOT NULL ,"id" SERIAL,"keyWords" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Note" (
"folderId" integer   ,"id" SERIAL,"name" text   ,"puzzleLevel" integer  NOT NULL ,"puzzleSize" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Puzz" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"eng" text  NOT NULL ,"folderId" integer   ,"id" SERIAL,"kor" text  NOT NULL ,"puzzleLevel" integer   ,"puzzleSize" integer   ,"setDate" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"tags" text []  ,"userId" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_FolderToPuzz" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE TABLE "public"."_GroupToUser" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE TABLE "public"."_HintToPuzz" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE TABLE "public"."_NoteToPuzz" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

ALTER TABLE "public"."Profile" DROP CONSTRAINT IF EXiSTS "Profile_userId_fkey",
DROP COLUMN "userId",
ADD COLUMN "userId" integer  NOT NULL ;

ALTER TABLE "public"."Post" DROP CONSTRAINT IF EXiSTS "Post_authorId_fkey";

CREATE UNIQUE INDEX "Folder.folderId" ON "public"."Folder"("folderId")

CREATE UNIQUE INDEX "Puzz.folderId" ON "public"."Puzz"("folderId")

CREATE UNIQUE INDEX "Puzz.userId" ON "public"."Puzz"("userId")

CREATE UNIQUE INDEX "_FolderToPuzz_AB_unique" ON "public"."_FolderToPuzz"("A","B")

CREATE  INDEX "_FolderToPuzz_B_index" ON "public"."_FolderToPuzz"("B")

CREATE UNIQUE INDEX "_GroupToUser_AB_unique" ON "public"."_GroupToUser"("A","B")

CREATE  INDEX "_GroupToUser_B_index" ON "public"."_GroupToUser"("B")

CREATE UNIQUE INDEX "_HintToPuzz_AB_unique" ON "public"."_HintToPuzz"("A","B")

CREATE  INDEX "_HintToPuzz_B_index" ON "public"."_HintToPuzz"("B")

CREATE UNIQUE INDEX "_NoteToPuzz_AB_unique" ON "public"."_NoteToPuzz"("A","B")

CREATE  INDEX "_NoteToPuzz_B_index" ON "public"."_NoteToPuzz"("B")

ALTER TABLE "public"."Folder" ADD FOREIGN KEY ("folderId")REFERENCES "public"."Folder"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Note" ADD FOREIGN KEY ("folderId")REFERENCES "public"."Folder"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Puzz" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_FolderToPuzz" ADD FOREIGN KEY ("A")REFERENCES "public"."Folder"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_FolderToPuzz" ADD FOREIGN KEY ("B")REFERENCES "public"."Puzz"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_GroupToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Group"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_GroupToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_HintToPuzz" ADD FOREIGN KEY ("A")REFERENCES "public"."Hint"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_HintToPuzz" ADD FOREIGN KEY ("B")REFERENCES "public"."Puzz"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_NoteToPuzz" ADD FOREIGN KEY ("A")REFERENCES "public"."Note"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_NoteToPuzz" ADD FOREIGN KEY ("B")REFERENCES "public"."Puzz"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."Post";

ALTER INDEX "public"."Profile_userId" RENAME TO "Profile.userId"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200517024050-init..20200521170419-puzzle-initial
--- datamodel.dml
+++ datamodel.dml
@@ -3,30 +3,74 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
-model Post {
-  authorId  Int?
-  content   String?
-  id        Int     @default(autoincrement()) @id
-  published Boolean @default(false)
-  title     String
-  author    User?   @relation(fields: [authorId], references: [id])
+model Folder {
+  id           Int      @default(autoincrement()) @id
+  name         String?
+  puzzleLevel  Int
+  puzzleSize   Int
+  notes        Note[]
+  puzzs        Puzz[]   @relation(references: [id])
+  folderId     Int?     @unique
+  parentFolder Folder?  @relation("FolderToFolder", fields: [folderId], references: [id])
+  subFolders   Folder[] @relation("FolderToFolder")
 }
+model Group {
+  id    Int    @default(autoincrement()) @id
+  name  String
+  users User[] @relation(references: [id])
+}
+
+model Hint {
+  id       Int    @default(autoincrement()) @id
+  hint     String
+  keyWords String
+  puzzs    Puzz[] @relation(references: [id])
+}
+
+model Note {
+  id          Int     @default(autoincrement()) @id
+  name        String?
+  puzzleLevel Int
+  puzzleSize  Int
+  folderId    Int?
+  folder      Folder? @relation(fields: [folderId], references: [id])
+  puzzs       Puzz[]  @relation(references: [id])
+}
+
 model Profile {
+  id     Int     @default(autoincrement()) @id
   bio    String?
-  id     Int     @id
-  userId Int?
-  user   User?   @relation(fields: [userId], references: [id])
+  userId Int     @unique
+  user   User    @relation(fields: [userId], references: [id])
 }
+model Puzz {
+  id          Int      @default(autoincrement()) @id
+  createdAt   DateTime @default(now())
+  eng         String
+  folderId    Int?     @unique
+  kor         String
+  puzzleLevel Int?
+  puzzleSize  Int?
+  setDate     DateTime @default(now())
+  tags        String[]
+  folders     Folder[] @relation(references: [id])
+  notes       Note[]   @relation(references: [id])
+  userId      Int      @unique
+  author      User     @relation(fields: [userId], references: [id])
+  hints       Hint[]   @relation(references: [id])
+}
+
 model User {
+  id      Int      @default(autoincrement()) @id
   email   String   @unique
-  id      Int      @default(autoincrement()) @id
   name    String?
-  posts   Post[]
-  profile Profile?
+  Profile Profile?
+  puzzes  Puzz[]
+  groups  Group[]  @relation(references: [id])
 }
```


